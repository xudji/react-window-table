function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

import { SP_ROUTE_PREFIX } from "../../constants";
import { useAppData, useSiteData } from 'dumi';
import Container from 'dumi/theme/builtins/Container';
import Previewer from 'dumi/theme/builtins/Previewer';
import React, { createElement } from 'react';
import { ErrorBoundary } from 'react-error-boundary';

var DemoErrorBoundary = function DemoErrorBoundary(props) {
  return /*#__PURE__*/React.createElement(ErrorBoundary, {
    fallbackRender: function fallbackRender(_ref) {
      var error = _ref.error;
      return /*#__PURE__*/React.createElement(Container, {
        type: "error"
      }, /*#__PURE__*/React.createElement("p", null, /*#__PURE__*/React.createElement("strong", null, error.message || 'This demo has been crashed.')), error.stack && /*#__PURE__*/React.createElement("p", null, /*#__PURE__*/React.createElement("details", {
        open: true
      }, /*#__PURE__*/React.createElement("summary", null, "Error stack"), /*#__PURE__*/React.createElement("pre", null, error.stack))));
    }
  }, props.children);
};

export var DumiDemo = function DumiDemo(props) {
  var _useSiteData = useSiteData(),
      demos = _useSiteData.demos;

  var _useAppData = useAppData(),
      basename = _useAppData.basename;

  var _demos$props$demo$id = demos[props.demo.id],
      component = _demos$props$demo$id.component,
      asset = _demos$props$demo$id.asset; // hide debug demo in production

  if (process.env.NODE_ENV === 'production' && props.previewerProps.debug) return null;

  if (props.demo.inline) {
    return /*#__PURE__*/React.createElement(DemoErrorBoundary, null, /*#__PURE__*/createElement(component));
  }

  return /*#__PURE__*/React.createElement(Previewer, _extends({
    asset: asset,
    demoUrl: // allow user override demoUrl by frontmatter
    props.previewerProps.demoUrl || "".concat(basename).concat(SP_ROUTE_PREFIX, "demos/").concat(props.demo.id)
  }, props.previewerProps), props.previewerProps.iframe ? null : /*#__PURE__*/React.createElement(DemoErrorBoundary, null, /*#__PURE__*/createElement(component)));
};